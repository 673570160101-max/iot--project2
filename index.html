<!doctype html>
<html lang="th">
  <head>
    <meta charset="utf-8" />
    <title>LED Control (RTDB)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body{font-family:system-ui, Arial; margin:2rem}
      button{font-size:1.2rem; padding:.6rem 1rem; margin-right:.5rem}
      #status{display:inline-block; min-width:5rem; font-weight:700}
    </style>
  </head>
  <body>
    <h1>🔥 ควบคุมหลอดไฟ – LED</h1>
    <p>สถานะ: <span id="status">—</span></p>
    <button id="onBtn">LED ON</button>
    <button id="offBtn">LED OFF</button>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
      import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js";
      import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
      // (ถ้าจะใช้ Analytics ค่อย import เพิ่ม: firebase-analytics.js)

      const firebaseConfig = {
        apiKey: "AIzaSyDY836mfJQaO0E1p4HLQmdobD-7ChlrlV8",
        authDomain: "iot-project2-3cff2.firebaseapp.com",
        databaseURL: "https://iot-project2-3cff2-default-rtdb.firebaseio.com",
        projectId: "iot-project2-3cff2",
        storageBucket: "iot-project2-3cff2.firebasestorage.app",
        messagingSenderId: "1005200649974",
        appId: "1:1005200649974:web:1235f031046ba7b5a046d7",
        measurementId: "G-137HKSTB99"
      };

      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);

      // แนะนำให้ใช้ Anonymous Auth (เปิดใน Console > Authentication)
      const auth = getAuth(app);
      signInAnonymously(auth).catch(err => console.error("Auth error:", err));

      const statusEl = document.getElementById("status");
      const onBtn = document.getElementById("onBtn");
      const offBtn = document.getElementById("offBtn");

      // เขียนค่าไปที่ /led เป็น "on"/"off"
      async function setLed(val) {
        await set(ref(db, "/led"), val);
      }

      // ฟังค่าจริงเวลา (ซิงค์กับบอร์ด)
      onValue(ref(db, "/led"), snap => {
        const v = snap.val();
        statusEl.textContent = v ?? "—";
      });

      onBtn.addEventListener("click", () => setLed("on"));
      offBtn.addEventListener("click", () => setLed("off"));
    </script>
  </body>
</html>
