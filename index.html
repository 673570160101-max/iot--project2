<!doctype html>
<html lang="th">
  <head>
    <meta charset="utf-8" />
    <title>LED Control (RTDB)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body{font-family:system-ui, Arial; margin:2rem}
      button{font-size:1.2rem; padding:.6rem 1rem; margin-right:.5rem}
      #status{display:inline-block; min-width:5rem; font-weight:700}
    </style>
  </head>
  <body>
    <h1>ðŸ”¥ à¸„à¸§à¸šà¸„à¸¸à¸¡à¸«à¸¥à¸­à¸”à¹„à¸Ÿ â€“ LED</h1>
    <p>à¸ªà¸–à¸²à¸™à¸°: <span id="status">â€”</span></p>
    <button id="onBtn">LED ON</button>
    <button id="offBtn">LED OFF</button>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
      import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js";
      import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
      // (à¸–à¹‰à¸²à¸ˆà¸°à¹ƒà¸Šà¹‰ Analytics à¸„à¹ˆà¸­à¸¢ import à¹€à¸žà¸´à¹ˆà¸¡: firebase-analytics.js)

      const firebaseConfig = {
        apiKey: "AIzaSyDY836mfJQaO0E1p4HLQmdobD-7ChlrlV8",
        authDomain: "iot-project2-3cff2.firebaseapp.com",
        databaseURL: "https://iot-project2-3cff2-default-rtdb.firebaseio.com",
        projectId: "iot-project2-3cff2",
        storageBucket: "iot-project2-3cff2.firebasestorage.app",
        messagingSenderId: "1005200649974",
        appId: "1:1005200649974:web:1235f031046ba7b5a046d7",
        measurementId: "G-137HKSTB99"
      };

      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);

      // à¹à¸™à¸°à¸™à¸³à¹ƒà¸«à¹‰à¹ƒà¸Šà¹‰ Anonymous Auth (à¹€à¸›à¸´à¸”à¹ƒà¸™ Console > Authentication)
      const auth = getAuth(app);
      signInAnonymously(auth).catch(err => console.error("Auth error:", err));

      const statusEl = document.getElementById("status");
      const onBtn = document.getElementById("onBtn");
      const offBtn = document.getElementById("offBtn");

      // à¹€à¸‚à¸µà¸¢à¸™à¸„à¹ˆà¸²à¹„à¸›à¸—à¸µà¹ˆ /led à¹€à¸›à¹‡à¸™ "on"/"off"
      async function setLed(val) {
        await set(ref(db, "/led"), val);
      }

      // à¸Ÿà¸±à¸‡à¸„à¹ˆà¸²à¸ˆà¸£à¸´à¸‡à¹€à¸§à¸¥à¸² (à¸‹à¸´à¸‡à¸„à¹Œà¸à¸±à¸šà¸šà¸­à¸£à¹Œà¸”)
      onValue(ref(db, "/led"), snap => {
        const v = snap.val();
        statusEl.textContent = v ?? "â€”";
      });

      onBtn.addEventListener("click", () => setLed("on"));
      offBtn.addEventListener("click", () => setLed("off"));
    </script>
  </body>
</html>
